name: Upstream Sync Detector

on:
  schedule:
    # æ¯é€±æœˆæ›œæ—¥ åˆå‰2æ™‚ï¼ˆJST åˆå‰11æ™‚ï¼‰
    - cron: '0 2 * * 1'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  check-upstream:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Add upstream
        run: |
          git remote add upstream https://github.com/SuperClaude-Org/SuperClaude_Framework.git
          git fetch upstream
      
      - name: Check for updates
        id: check
        run: |
          if [ $(git rev-list HEAD...upstream/master --count) -gt 0 ]; then
            echo "æœ‰æ›´æ–°"
            echo "has_updates=true" >> $GITHUB_OUTPUT
          else
            echo "ç„¡æ›´æ–°"  
            echo "has_updates=false" >> $GITHUB_OUTPUT
          fi
      
      - name: Create Issue on Updates
        if: steps.check.outputs.has_updates == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ğŸ“¦ SuperClaudeæœ¬å®¶ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ',
              body: `
              ## ğŸš€ æœ¬å®¶ãƒªãƒã‚¸ãƒˆãƒªã®æ›´æ–°æ¤œå‡º
              
              SuperClaude_Frameworkã«æ–°ã—ã„å¤‰æ›´ãŒã‚ã‚Šã¾ã™ã€‚
              
              ### å¯¾å¿œæ–¹æ³•
              Claude Codeã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
              \`\`\`
              /sc:sync-upstream
              \`\`\`
              
              ### æ›´æ–°å†…å®¹ç¢ºèª
              [æœ¬å®¶ã®æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ](https://github.com/SuperClaude-Org/SuperClaude_Framework/commits/master)
              
              ---
              *ã“ã®issueã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*
              `,
              labels: ['è‡ªå‹•åŒ–', 'æœ¬å®¶æ›´æ–°', 'ç¿»è¨³å¿…è¦']
            })
