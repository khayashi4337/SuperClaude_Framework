name: Upstream Sync Detector

on:
  schedule:
    # 毎週月曜日 午前2時（JST 午前11時）
    - cron: '0 2 * * 1'
  workflow_dispatch: # 手動実行も可能

jobs:
  check-upstream:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Add upstream
        run: |
          git remote add upstream https://github.com/SuperClaude-Org/SuperClaude_Framework.git
          git fetch upstream
      
      - name: Check for updates
        id: check
        run: |
          if [ $(git rev-list HEAD...upstream/master --count) -gt 0 ]; then
            echo "有更新"
            echo "has_updates=true" >> $GITHUB_OUTPUT
          else
            echo "無更新"  
            echo "has_updates=false" >> $GITHUB_OUTPUT
          fi
      
      - name: Create Issue on Updates
        if: steps.check.outputs.has_updates == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '📦 SuperClaude本家が更新されました',
              body: `
              ## 🚀 本家リポジトリの更新検出
              
              SuperClaude_Frameworkに新しい変更があります。
              
              ### 対応方法
              Claude Codeで以下のコマンドを実行してください：
              \`\`\`
              /sc:sync-upstream
              \`\`\`
              
              ### 更新内容確認
              [本家の最新コミット](https://github.com/SuperClaude-Org/SuperClaude_Framework/commits/master)
              
              ---
              *このissueは自動生成されました*
              `,
              labels: ['自動化', '本家更新', '翻訳必要']
            })
